# 记忆树工作流监控系统开发文档

## 1. 项目概述

### 1.1 项目目标
在记忆树项目基础上扩展工作流监控功能，实现自动化执行并监控各处理节点。

### 1.2 核心功能
- 自动化执行完整工作流
- 监控各处理节点的状态
- 查看节点间的数据流转
- 可视化展示处理进度

## 2. 系统架构

### 2.1 工作流程
1. 对话输入
2. 叙事体生成
3. SVG卡片生成
4. 综合分析（段落分析+标签分析）
5. 持久化存储

### 2.2 核心组件
- WorkflowManager：工作流程管理器（新增，内存管理）
- 原有Agent和Service的监控包装器
- 监控界面
- MySQL数据存储模块

### 2.3 代码组织
project_root/
├── workflow/
│   ├── core/
│   └── ui/
├── agents/
├── services/
└── database/

## 3. 实现策略

### 3.1 对现有代码的修改
1. 为现有Agent和Service添加监控接口
   - 添加执行状态追踪
   - 添加输入输出记录
   - 保持原有功能不变

2. 界面集成
   - 添加独立的监控界面
   - 可以从主界面启动监控视图

## 4. 界面设计

### 4.1 布局结构
- 左侧：工作流程图
- 右侧：节点详情面板

### 4.2 左侧工作流程图
- 垂直布局的节点列表
- 节点状态图标
- 节点间连接线
- 状态指示器

### 4.3 右侧详情面板
- 节点基本信息区
- 数据展示区（选项卡式）
- 控制按钮区

## 5. 内存数据管理

### 5.1 节点数据结构
python
{
"node_id": str,
"node_name": str,
"status": str, # waiting/running/completed/error
"start_time": datetime,
"end_time": datetime,
"input_data": dict,
"output_data": dict,
"error_info": str
}
### 5.2 状态管理
- 节点状态实时更新（内存中）
- 数据流转记录（内存中）
- 错误处理机制
- 会话结束时清理数据

## 6. 实现计划

### 6.1 第一阶段
- 搭建项目基础框架
- 复刻并优化现有Agent和Service
- 实现内存中的工作流管理器
- 设计基础界面框架

### 6.2 第二阶段
- 完善节点监控功能
- 实现数据流转可视化
- 实现实时数据更新
- 添加错误处理机制

### 6.3 第三阶段
- 界面美化和交互优化
- 添加数据导出功能
- 系统测试和优化

## 7. 技术栈
- Python 3.8+
- PyQt5
- MySQL 8.0+
- SQLAlchemy
- 智谱AI API

## 8. 注意事项
- 保持与原有项目的解耦
- 确保监控不影响核心功能性能
- 做好异常处理
- 保持界面响应流畅
- 优化数据库查询性能

## 9. 项目规范
- 遵循PEP8编码规范
- 编写完整的注释和文档
- 做好版本控制
- 编写单元测试
## 1. 核心文件职责
services/dialogue_service.py
- 处理用户实时对话
- 维护对话历史
- 检查触发条件（如5轮对话）
- 触发工作流处理

workflow/core/
├── node.py
│   - 定义节点基类
│   - 提供基础处理接口
│   - 状态管理
│
├── node_types.py
│   - ConversationNode: 对话处理节点
│   - NarrativeNode: 叙事生成节点
│   - SVGNode: SVG生成节点
│   - AnalysisNode: 分析和持久化节点
│
├── workflow_thread.py
│   - 执行单个工作单元的处理流程
│   - 管理节点间数据传递
│
└── workflow_manager.py
    - 管理工作单元
    - 任务状态管理
    - 提供状态查询接口
## 2. 工作流程
1. 对话服务处理
用户输入 -> DialogueService
    -> RAG检索
    -> 生成回复（快速返回）
    -> 更新对话历史
    -> 检查触发条件
    -> 如果触发，创建工作单元
2. 工作单元处理
工作单元创建
    -> ConversationNode处理
    -> NarrativeNode处理
    -> 并行：
       ├-> SVGNode (完成后可查询)
       └-> AnalysisNode (完成后持久化)
3. 前端交互
发送消息 -> 快速获得回复
    -> 如果触发工作流，获得任务ID
    -> 通过任务ID轮询获取SVG结果
## 3. 关键点
1. 对话服务
- 保持快速响应
- 独立的触发检查
- 工作单元创建解耦
2. 工作流处理
- 基于工作单元
- 节点间数据传递
- 支持状态查询
- 完整的处理记录
3. 状态管理
- 工作单元状态追踪
- 节点处理状态
- 处理进度记录
- 错误信息记录


## 4. 注意事项
- 用尽量少的文件实现该功能，优雅的完成该任务。
- 注意这是个后端服务，但是要为后续的服务可视化做好准备！！！
